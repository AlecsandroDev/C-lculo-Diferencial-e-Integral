<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CalcTool Pro - Calculadora Visual</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/echarts@5.4.3/dist/echarts.min.js"></script>
    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>

    <style>
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 2rem 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        .main-card {
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            overflow: hidden;
            margin-bottom: 50px;
        }

        .header-section {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 2rem;
            text-align: center;
        }

        .header-section h1 {
            font-size: 2.5rem;
            font-weight: 700;
            margin: 0;
        }

        .header-section p {
            margin: 0.5rem 0 0 0;
            opacity: 0.95;
            font-size: 1.1rem;
        }

        .nav-tabs {
            border-bottom: 2px solid #e0e0e0;
            padding: 0 1rem;
        }

        .nav-tabs .nav-link {
            border: none;
            color: #666;
            font-weight: 600;
            padding: 1rem 1.5rem;
            transition: all 0.3s;
        }

        .nav-tabs .nav-link:hover {
            color: #667eea;
        }

        .nav-tabs .nav-link.active {
            color: #667eea;
            border-bottom: 3px solid #667eea;
            background: transparent;
        }

        .form-control:focus {
            border-color: #667eea;
            box-shadow: 0 0 0 0.2rem rgba(102, 126, 234, 0.25);
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border: none;
            padding: 0.75rem 2rem;
            font-weight: 600;
            transition: transform 0.2s;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(102, 126, 234, 0.4);
        }

        .resultado-card {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 2rem;
            margin-top: 2rem;
            border: 1px solid #e9ecef;
        }

        .resultado-math {
            background: white;
            padding: 2.5rem;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.05);
            margin-bottom: 2rem;
            text-align: center;
            font-size: 1.2rem;
            line-height: 2.8;
        }

        .step-by-step {
            margin-top: 3rem;
        }

        .step-by-step h5 {
            color: #667eea;
            font-weight: 700;
            margin-bottom: 2rem;
            text-transform: uppercase;
            letter-spacing: 1px;
            font-size: 0.95rem;
        }

        .step-item {
            background: white;
            padding: 2rem;
            margin-bottom: 2rem;
            border-left: 5px solid #667eea;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.03);
            transition: transform 0.2s;
            font-size: 1.05rem;
            line-height: 2.5;
        }

        .step-item:hover {
            transform: translateX(5px);
        }

        #main-chart {
            background: white;
            border-radius: 10px;
            padding: 1rem;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            margin-top: 2rem;
        }

        .controles-integral {
            background: white;
            padding: 1.5rem;
            border-radius: 10px;
            margin-bottom: 1.5rem;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        .area-info {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 15px;
        }

        .area-box {
            padding: 1.5rem;
            border-radius: 12px;
            text-align: center;
            transition: transform 0.2s;
        }

        .area-box:hover {
            transform: translateY(-3px);
        }

        .area-box h6 {
            font-size: 0.85rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 0.8rem;
            font-weight: 600;
        }

        .area-box .valor {
            font-size: 1.8rem;
            font-weight: 800;
            margin: 0.5rem 0;
        }

        .area-box small {
            display: block;
            margin-top: 0.5rem;
            font-size: 0.85rem;
        }

        .badge-dinamico {
            background: #667eea;
            color: white;
            padding: 0.4rem 1rem;
            border-radius: 20px;
            font-weight: 600;
        }

        .config-aba {
            animation: fadeIn 0.3s;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
    </style>
</head>

<body>

    <div class="container">
        <div class="main-card">
            <div class="header-section">
                <h1>üìä CalcTool Pro</h1>
                <p>Visualiza√ß√£o Interativa de C√°lculo Diferencial e Integral</p>
            </div>

            <ul class="nav nav-tabs" role="tablist">
                <li class="nav-item">
                    <button class="nav-link {% if aba_ativa == 'limite' %}active{% endif %}"
                        onclick="mudarAba('limite')">
                        Limites
                    </button>
                </li>
                <li class="nav-item">
                    <button class="nav-link {% if aba_ativa == 'derivada' %}active{% endif %}"
                        onclick="mudarAba('derivada')">
                        Derivada
                    </button>
                </li>
                <li class="nav-item">
                    <button class="nav-link {% if aba_ativa == 'pontos_criticos' %}active{% endif %}"
                        onclick="mudarAba('pontos_criticos')">
                        Pontos Cr√≠ticos
                    </button>
                </li>
                <li class="nav-item">
                    <button class="nav-link {% if aba_ativa == 'integral' %}active{% endif %}"
                        onclick="mudarAba('integral')">
                        Integral
                    </button>
                </li>
            </ul>

            <div class="p-4">
                <form method="POST" action="/">
                    <input type="hidden" name="aba_ativa" id="input_aba_ativa" value="{{ aba_ativa }}">

                    <div class="mb-4">
                        <label class="form-label fw-bold">üìê Fun√ß√£o f(x):</label>
                        <input type="text" class="form-control form-control-lg" name="funcao" value="{{ funcao }}"
                            placeholder="Ex: x**2, sin(x), 1/(x-2)" required>
                        <small class="text-muted">
                            Use: ** (pot√™ncia), sqrt() (raiz), sin/cos/tan, exp(), log()
                        </small>
                    </div>

                    <div class="config-aba" id="div-limite" {% if aba_ativa !='limite' %}style="display:none" {% endif
                        %}>
                        <label class="form-label">Ponto de tend√™ncia (x ‚Üí p):</label>
                        <input type="number" step="any" class="form-control" name="ponto_limite"
                            value="{{ params.ponto }}">
                    </div>


                    <div class="config-aba" id="div-derivada" {% if aba_ativa !='derivada' %}style="display:none" {%
                        endif %}>
                        <label class="form-label text-center w-100">
                            Ponto da Reta Tangente: <span class="badge-dinamico" id="val_ponto_tangente_form">0</span>
                        </label>
                        <input type="range" class="form-range" min="-10" max="10" step="0.5" name="ponto_tangente"
                            id="slider_ponto_tangente_form" value="{{ params.ponto_tangente }}">
                        <input type="hidden" name="ponto_tangente" id="hidden_ponto_tangente"
                            value="{{ params.ponto_tangente }}">
                    </div>

                    <div class="config-aba" id="div-integral" {% if aba_ativa !='integral' %}style="display:none" {%
                        endif %}>
                        <div class="row g-3">
                            <div class="col-md-6">
                                <label class="form-label">In√≠cio do intervalo (a):</label>
                                <input type="number" step="any" class="form-control" name="int_a"
                                    value="{{ params.int_a }}">
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">Fim do intervalo (b):</label>
                                <input type="number" step="any" class="form-control" name="int_b"
                                    value="{{ params.int_b }}">
                            </div>
                        </div>
                    </div>

                    <button type="submit" class="btn btn-primary w-100 btn-lg mt-4">
                        üöÄ Calcular e Visualizar
                    </button>
                </form>
            </div>

            {% if resultado %}
            <div class="resultado-card mx-4 mb-4">
                <h4 class="text-center mb-4" style="color: #667eea; font-weight: 700;">
                    üìà Resultado Final
                </h4>

                <div class="resultado-math">
                    $$ {{ resultado | safe }} $$
                </div>

                {% if steps %}
                <div class="step-by-step">
                    <h5>üìù Resolu√ß√£o Passo a Passo</h5>
                    {% for step in steps %}
                    <div class="step-item">
                        $$ {{ step | safe }} $$
                    </div>
                    {% endfor %}
                </div>
                {% endif %}

                {% if dados_grafico %}
                <hr class="my-5">
                <h4 class="text-center mb-4" style="color: #667eea;">
                    üìä Visualiza√ß√£o Gr√°fica Interativa
                </h4>

                <div id="controles-dinamicos" style="display: none;">
                    <div class="controles-integral">
                        <h6 class="text-center mb-3" style="color: #667eea; font-weight: 700;">
                            üéöÔ∏è Controle Din√¢mico de Aproxima√ß√£o
                        </h6>

                        <div class="area-info">
                            <div class="area-box"
                                style="background: linear-gradient(135deg, #e8f4fc 0%, #c3e0f7 100%); border: 2px solid #3498db;">
                                <h6 style="color: #2980b9;">Integral L√≠quida</h6>
                                <div class="valor" id="integral_liquida_display" style="color: #2980b9;">-</div>
                                <small class="text-muted">Soma Riemann: <strong
                                        id="soma_liquida_display">-</strong></small>
                                <small class="text-muted" style="font-size: 0.75rem;">Considera sinal (+ e -)</small>
                            </div>
                            <div class="area-box"
                                style="background: linear-gradient(135deg, #fef5e7 0%, #fdeaa8 100%); border: 2px solid #f39c12;">
                                <h6 style="color: #e67e22;">√Årea Geom√©trica</h6>
                                <div class="valor" id="area_geometrica_display" style="color: #e67e22;">-</div>
                                <small class="text-muted">Soma Riemann: <strong
                                        id="soma_absoluta_display">-</strong></small>
                                <small class="text-muted" style="font-size: 0.75rem;">Sempre positiva (|f(x)|)</small>
                            </div>
                        </div>

                        <label class="form-label text-center w-100">
                            N√∫mero de Ret√¢ngulos: <span class="badge-dinamico" id="val_n_dinamico">10</span>
                        </label>
                        <input type="range" class="form-range" min="1" max="100" id="slider_dinamico" value="10">
                    </div>
                </div>

                <div id="main-chart" style="width: 100%; height: 600px;"></div>
                {% endif %}
            </div>
            {% endif %}
        </div>
    </div>

    <script>
        function mudarAba(aba) {
            document.getElementById('input_aba_ativa').value = aba;
            document.querySelectorAll('.nav-link').forEach(el => el.classList.remove('active'));
            event.target.classList.add('active');
            document.querySelectorAll('.config-aba').forEach(el => el.style.display = 'none');

            if (aba === 'limite') {
                document.getElementById('div-limite').style.display = 'block';
            } else if (aba === 'derivada') {
                document.getElementById('div-derivada').style.display = 'block';
            } else if (aba === 'integral') {
                document.getElementById('div-integral').style.display = 'block';
            }
        }
    </script>
    <script>
        {% if dados_grafico %}
        (function () {
            const dadosOriginais = {{ dados_grafico | safe
        }};
        const chartDom = document.getElementById('main-chart');
        const myChart = echarts.init(chartDom);

        const commonConfig = {
            toolbox: {
                feature: {
                    dataZoom: { yAxisIndex: 'none' },
                    restore: {},
                    saveAsImage: { name: 'calctool_grafico' }
                },
                right: 20,
                top: 10
            },
            tooltip: {
                trigger: 'axis',
                axisPointer: { type: 'cross' }
            },
            grid: {
                left: '8%',
                right: '8%',
                bottom: '15%',
                top: '15%',
                containLabel: true
            },
            dataZoom: [
                { type: 'inside', xAxisIndex: 0, filterMode: 'filter' },
                { type: 'slider', xAxisIndex: 0, filterMode: 'filter', bottom: '5%' },
                { type: 'inside', yAxisIndex: 0, filterMode: 'empty' }
            ],
            xAxis: {
                type: 'value',
                name: 'x',
                nameLocation: 'middle',
                nameGap: 30,
                minInterval: 1,
                axisLabel: { formatter: '{value}' },
                minorTick: { show: true },
                splitLine: { show: true, lineStyle: { type: 'dashed', opacity: 0.3 } }
            },
            yAxis: {
                type: 'value',
                name: 'f(x)',
                nameLocation: 'middle',
                nameGap: 50,
                minInterval: 1,
                axisLabel: { formatter: '{value}' },
                minorTick: { show: true },
                splitLine: { show: true, lineStyle: { type: 'dashed', opacity: 0.3 } }
            }
        };

        let option = {};

        // =======================================
        // LIMITE - REFEITO
        // =======================================
        if (dadosOriginais.tipo === "limite") {

            function safeFormat(x, y) {
                if (typeof y === "number" && isFinite(y)) {
                    return `(${x.toFixed(2)}, ${y.toFixed(2)})`;
                }
                return `(${x.toFixed(2)}, n/a)`;
            }

            const yReal = (typeof dadosOriginais.ponto_destaque.y === "number" && isFinite(dadosOriginais.ponto_destaque.y))
                ? dadosOriginais.ponto_destaque.y
                : null;

            const isAberta = dadosOriginais.ponto_destaque.estilo === "aberta";

            option = {
                ...commonConfig,
                title: {
                    text: "An√°lise de Limite e Continuidade",
                    left: "center",
                    textStyle: { fontSize: 18, fontWeight: "bold" }
                },
                legend: {
                    data: ["f(x)", isAberta ? "Bolinha Aberta (‚óã)" : "Bolinha Fechada (‚óè)"],
                    top: 40
                },
                series: [
                    {
                        name: "f(x)",
                        type: "line",
                        data: dadosOriginais.eixo_x.map((x, i) => [x, dadosOriginais.eixo_y[i]]),
                        smooth: true,
                        lineStyle: { width: 3, color: "#667eea" },
                        showSymbol: false
                    },
                    {
                        name: isAberta ? "Bolinha Aberta (‚óã)" : "Bolinha Fechada (‚óè)",
                        type: "scatter",
                        data: [[dadosOriginais.ponto_destaque.x, yReal]],
                        symbolSize: 24,
                        itemStyle: {
                            color: isAberta ? "white" : "#e74c3c",
                            borderColor: "#e74c3c",
                            borderWidth: 3
                        },
                        label: {
                            show: true,
                            formatter: p => safeFormat(p.value[0], p.value[1]),
                            position: "top",
                            backgroundColor: "white",
                            padding: [6, 10],
                            borderRadius: 6
                        }
                    }
                ]
            };

            myChart.setOption(option);
        }

        // =======================================
        // DERIVADA - REFEITO COM TANGENTE DIN√ÇMICA
        // =======================================
        else if (dadosOriginais.tipo === "derivada") {

            const slider = document.getElementById("slider_ponto_tangente_form") ||
                document.getElementById("slider_dinamico");

            const badge = document.getElementById("val_ponto_tangente_form") ||
                document.getElementById("val_dinamico");

            // Arrays num√©ricos
            const xs = dadosOriginais.eixo_x.map(Number);
            const ys = dadosOriginais.eixo_y.map(v => (typeof v === "number" ? v : NaN));

            // ‚Äî‚Äî‚Äî Fun√ß√£o de interpola√ß√£o ‚Äî‚Äî‚Äî
            function interpola(x0) {
                for (let i = 0; i < xs.length - 1; i++) {
                    if (x0 >= xs[i] && x0 <= xs[i + 1]) {
                        const t = (x0 - xs[i]) / (xs[i + 1] - xs[i]);
                        return ys[i] + t * (ys[i + 1] - ys[i]);
                    }
                }
                return NaN;
            }

            // ‚Äî‚Äî‚Äî Derivada num√©rica (diferen√ßa central) ‚Äî‚Äî‚Äî
            function derivada(x0) {
                let i = xs.findIndex(x => x >= x0);
                i = Math.max(1, Math.min(i, xs.length - 2));

                const xA = xs[i - 1], xB = xs[i + 1];
                const yA = ys[i - 1], yB = ys[i + 1];

                if (!isFinite(yA) || !isFinite(yB)) return 0;

                return (yB - yA) / (xB - xA);
            }

            // ‚Äî‚Äî‚Äî Renderiza o gr√°fico ‚Äî‚Äî‚Äî
            function render(x0) {
                const y0 = interpola(x0);
                const m = derivada(x0);

                const rx = [x0 - 5, x0 + 5];
                const ry = rx.map(x => m * (x - x0) + y0);

                option = {
                    ...commonConfig,
                    title: {
                        text: `Tangente em x = ${x0.toFixed(2)}`,
                        left: "center",
                        textStyle: { fontSize: 18, fontWeight: "bold" }
                    },
                    legend: {
                        data: ["f(x)", `Tangente (m = ${m.toFixed(4)})`, "Ponto"],
                        top: 40
                    },
                    series: [
                        {
                            name: "f(x)",
                            type: "line",
                            data: xs.map((x, i) => [x, ys[i]]),
                            smooth: true,
                            lineStyle: { width: 3 }
                        },
                        {
                            name: `Tangente (m = ${m.toFixed(4)})`,
                            type: "line",
                            data: rx.map((x, i) => [rx[i], ry[i]]),
                            lineStyle: { width: 3, type: "dashed", color: "#e74c3c" }
                        },
                        {
                            name: "Ponto",
                            type: "scatter",
                            data: [[x0, y0]],
                            symbolSize: 20,
                            itemStyle: { color: "#f39c12" }
                        }
                    ]
                };

                myChart.setOption(option);
            }

            // Configura slider
            const xInicial = dadosOriginais.ponto_tangente.x;
            slider.min = Math.min(...xs);
            slider.max = Math.max(...xs);
            slider.step = 0.1;
            slider.value = xInicial;
            badge.innerText = xInicial.toFixed(2);

            render(xInicial);

            slider.addEventListener("input", e => {
                const val = parseFloat(e.target.value);
                badge.innerText = val.toFixed(2);
                render(val);
            });
        }

        // usar slider da forma correta (slider_ponto_tangente_form)
        const sliderTang = document.getElementById('slider_ponto_tangente_form');
        const badgeTang = document.getElementById('val_ponto_tangente_form');

        const xInicial = dadosOriginais.ponto_tangente.x;
        // configura range conforme dados do eixo para melhorar UX
        sliderTang.min = Math.min(...xs);
        sliderTang.max = Math.max(...xs);
        sliderTang.step = 0.1;
        sliderTang.value = xInicial;
        badgeTang.innerText = parseFloat(xInicial).toFixed(2);

        renderizarGrafico(parseFloat(xInicial));

        // Evento do slider
        sliderTang.addEventListener('input', function (e) {
            const xTangente = parseFloat(e.target.value);
            badgeTang.innerText = xTangente.toFixed(2);
            renderizarGrafico(xTangente);
        });
        }

        // =======================================
        // PONTOS CR√çTICOS (manter igual)
        // =======================================
        else if (dadosOriginais.tipo === 'pontos_criticos') {
            const cores = {
                'M√°ximo': '#e74c3c',
                'M√≠nimo': '#2ecc71',
                'Inflex√£o': '#f39c12'
            };

            option = {
                ...commonConfig,
                title: {
                    text: 'Pontos Cr√≠ticos (M√°ximos, M√≠nimos e Inflex√£o)',
                    left: 'center',
                    textStyle: { fontSize: 18, fontWeight: 'bold' }
                },
                legend: { data: ['f(x)', 'M√°ximos', 'M√≠nimos', 'Inflex√£o'], top: 40 },
                series: [{
                    name: 'f(x)',
                    type: 'line',
                    data: dadosOriginais.eixo_x.map((x, i) => [x, dadosOriginais.eixo_y[i]]),
                    smooth: true,
                    lineStyle: { width: 3, color: '#667eea' },
                    showSymbol: false,
                    connectNulls: false
                }].concat(['M√°ximo', 'M√≠nimo', 'Inflex√£o'].map(tipo => ({
                    name: tipo + 's',
                    type: 'scatter',
                    data: dadosOriginais.pontos.filter(p => p.tipo === tipo).map(p => [p.x, p.y]),
                    symbolSize: 24,
                    itemStyle: {
                        color: cores[tipo],
                        borderColor: cores[tipo],
                        borderWidth: 3
                    },
                    label: {
                        show: true,
                        formatter: (params) => {
                            const idx = dadosOriginais.pontos.findIndex(
                                p => p.tipo === tipo && p.x === params.value[0]
                            );
                            return dadosOriginais.pontos[idx].label;
                        },
                        position: 'top',
                        color: '#333',
                        fontWeight: 'bold',
                        backgroundColor: 'rgba(255,255,255,0.95)',
                        padding: [8, 12],
                        borderRadius: 6,
                        borderColor: cores[tipo],
                        borderWidth: 1
                    }
                })))
            };

            myChart.setOption(option);
        }

        // =======================================
        // INTEGRAL (manter igual)
        // =======================================
        else if (dadosOriginais.tipo === 'integral') {
            document.getElementById('controles-dinamicos').style.display = 'block';
            document.querySelector('.controles-integral h6').innerText = 'üéöÔ∏è Controle Din√¢mico de Aproxima√ß√£o';
            document.querySelector('.area-info').style.display = 'grid'; // Mostrar boxes

            function calcularRetangulos(n) {
                const a = dadosOriginais.intervalo[0];
                const b = dadosOriginais.intervalo[1];
                const delta_x = (b - a) / n;

                const retangulos = [];
                let soma_liquida = 0;
                let soma_absoluta = 0;

                for (let i = 0; i < n; i++) {
                    const x_esq = a + i * delta_x;
                    const idx = dadosOriginais.eixo_x.findIndex(x => x >= x_esq);
                    const altura = dadosOriginais.eixo_y[idx] || 0;

                    if (altura !== null) {
                        retangulos.push({ x: x_esq, largura: delta_x, altura: altura });
                        soma_liquida += altura * delta_x;
                        soma_absoluta += Math.abs(altura * delta_x);
                    }
                }

                return { retangulos, soma_liquida, soma_absoluta };
            }

            function renderizarGrafico(n) {
                const { retangulos, soma_liquida, soma_absoluta } = calcularRetangulos(n);

                document.getElementById('integral_liquida_display').innerText = dadosOriginais.integral_liquida.toFixed(6);
                document.getElementById('soma_liquida_display').innerText = soma_liquida.toFixed(6);
                document.getElementById('area_geometrica_display').innerText = dadosOriginais.area_geometrica.toFixed(6);
                document.getElementById('soma_absoluta_display').innerText = soma_absoluta.toFixed(6);

                option = {
                    ...commonConfig,
                    title: {
                        text: `Soma de Riemann (n = ${n} ret√¢ngulos)`,
                        left: 'center',
                        textStyle: { fontSize: 18, fontWeight: 'bold' }
                    },
                    legend: {
                        data: ['f(x)', 'Ret√¢ngulos (+)', 'Ret√¢ngulos (-)'],
                        top: 40
                    },
                    series: [{
                        name: 'f(x)',
                        type: 'line',
                        data: dadosOriginais.eixo_x.map((x, i) => [x, dadosOriginais.eixo_y[i]]),
                        smooth: true,
                        lineStyle: { width: 3, color: '#667eea' },
                        showSymbol: false,
                        z: 10,
                        connectNulls: false
                    }, {
                        name: 'Ret√¢ngulos',
                        type: 'custom',
                        renderItem: function (params, api) {
                            const dataIndex = params.dataIndex;
                            const ret = retangulos[dataIndex];

                            const x_inicio = api.coord([ret.x, 0])[0];
                            const x_fim = api.coord([ret.x + ret.largura, 0])[0];
                            const y_zero = api.coord([0, 0])[1];
                            const y_val = api.coord([0, ret.altura])[1];

                            const isPositivo = ret.altura >= 0;

                            return {
                                type: 'rect',
                                shape: {
                                    x: x_inicio,
                                    y: Math.min(y_zero, y_val),
                                    width: x_fim - x_inicio,
                                    height: Math.abs(y_zero - y_val)
                                },
                                style: {
                                    fill: isPositivo ? 'rgba(52, 152, 219, 0.5)' : 'rgba(231, 76, 60, 0.5)',
                                    stroke: isPositivo ? 'rgba(52, 152, 219, 0.9)' : 'rgba(231, 76, 60, 0.9)',
                                    lineWidth: 1
                                }
                            };
                        },
                        data: retangulos,
                        z: 5
                    }]
                };

                myChart.setOption(option);
            }

            const slider = document.getElementById('slider_dinamico');
            slider.value = 10;
            document.getElementById('val_n_dinamico').innerText = 10;
            renderizarGrafico(10);

            slider.addEventListener('input', function (e) {
                const n = parseInt(e.target.value);
                document.getElementById('val_n_dinamico').innerText = n;
                renderizarGrafico(n);
            });
        }

        window.addEventListener('resize', () => myChart.resize());
}) ();
        {% endif %}
    </script>